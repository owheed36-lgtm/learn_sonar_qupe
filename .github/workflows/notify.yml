name: Simplified Enhanced Notification

on:
  push:
    branches: [ main, master ]
  pull_request:
    types: [opened, synchronize, reopened, closed]

jobs:
  slack-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_CHANNEL: test_channel
          SLACK_USERNAME: CI-Bot ğŸ¤–
          SLACK_ICON_EMOJI: ":rocket:"
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}

          SLACK_COLOR: |
            ${{ github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == 'true' && 'good' || 
                github.event_name == 'pull_request' && github.event.action == 'closed' && 'danger' ||
                'warning' }}

          SLACK_TITLE: |
            ${{ github.event_name == 'pull_request' && format('{0} PR: {1}', 
                github.event.action == 'opened' && 'ğŸ“ New' ||
                github.event.action == 'closed' && github.event.pull_request.merged && 'âœ… Merged' ||
                github.event.action == 'closed' && 'âŒ Closed' ||
                github.event.action == 'reopened' && 'ğŸ”„ Reopened' ||
                github.event.action == 'synchronize' && 'ğŸ”„ Updated' ||
                'ğŸ“', github.event.pull_request.title) || 
                'ğŸš€ Code Pushed' }}

          SLACK_MESSAGE: |
            <!channel>
            ğŸ‘‹ *Owner:* <@${{ github.event_name == 'pull_request' && github.event.pull_request.user.login || github.actor }}>
            *ğŸ“¦ Repository:* `${{ github.repository }}`
            ${{ github.event_name == 'pull_request' && format('*ğŸŒ¿ Branch:* `{0}` â†’ `{1}`', github.event.pull_request.head.ref, github.event.pull_request.base.ref) || format('*ğŸŒ¿ Branch:* `{0}`', github.ref_name) }}

            ${{ github.event_name == 'pull_request' && format('*ğŸ“„ PR Title:* {0}', github.event.pull_request.title) }}

            ${{ github.event_name == 'pull_request' && github.event.pull_request.body && format('*ğŸ“‹ Description:* {0}', github.event.pull_request.body) || '' }}

            *ğŸ”— Links:*
            ${{ github.event_name == 'pull_request' && format('â€¢ <{0}|View Pull Request>', github.event.pull_request.html_url) || format('â€¢ <https://github.com/{0}/commit/{1}|View Commit>', github.repository, github.sha) }}
            ${{ github.event_name == 'pull_request' && format('â€¢ <https://github.com/{0}/compare/{1}...{2}|View Changes>', github.repository, github.event.pull_request.base.ref, github.event.pull_request.head.ref) || format('â€¢ <https://github.com/{0}/tree/{1}|View Branch>', github.repository, github.ref_name) }}
            â€¢ <https://github.com/${{ github.repository }}|Repository Home>

            _Triggered by ${{ github.actor }}_

          MSG_MINIMAL: false
